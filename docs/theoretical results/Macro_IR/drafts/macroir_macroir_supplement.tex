\documentclass[11pt]{article}
\usepackage{amsmath,amssymb,mathtools}

\begin{document}

\section*{Supplementary Material: Full Derivations for MacroIR Interval Analysis}

\subsection*{S1. Boundary-State Statistics}

Let $\mu^{\text{prior}}_0 \in \mathbb{R}^K$ and 
$\Sigma^{\text{prior}}_0 \in \mathbb{R}^{K\times K}$ denote the
start-of-interval state distribution. The Markov transition matrix over the
interval is
\[
P(t) = e^{Qt},\qquad P_{i_0\to i_t}(t).
\]

Define $N_{i_0\to i_t}$ as the number of channels starting in $i_0$ and ending in $i_t$.

\paragraph{Mean.}
\[
\mu^{\text{prior}}_{0\to t,(i_0\to i_t)}
= \mu^{\text{prior}}_{0,i_0}\,P_{i_0\to i_t}(t).
\]

\paragraph{Covariance.}
Using multinomial splitting and the law of total covariance,
\begin{align}
\Sigma^{\text{prior}}_{0\to t,(i_0\to i_t)(j_0\to j_t)}
&=
P_{i_0\to i_t}(t)\bigl(\Sigma^{\text{prior}}_{0,i_0 j_0} - \delta_{i_0j_0}\mu^{\text{prior}}_{0,i_0}\bigr)
P_{j_0\to j_t}(t)
\nonumber\\
&\quad+
\delta_{i_0j_0}\delta_{i_t j_t}\,\mu^{\text{prior}}_{0,i_0}P_{i_0\to i_t}(t).
\end{align}

\subsection*{S2. Predicted Interval-Averaged Current}

Define the boundary-conditioned current expectation
\[
(\gamma_{0\to t})_{(i_0\to i_t)} = \overline{\Gamma}_{i_0\to i_t}.
\]

Marginalizing over end states gives
\[
(\overline{\gamma}_0)_{i_0}
= \sum_{i_t} P_{i_0\to i_t}(t)\,\overline{\Gamma}_{i_0\to i_t}.
\]

Thus,
\[
\overline{y}^{\mathrm{pred}}_{0\to t}
= N_{\mathrm{ch}}\sum_{i_0,i_t}
\mu^{\text{prior}}_{0,i_0}P_{i_0\to i_t}(t)\overline{\Gamma}_{i_0\to i_t}.
\]

\subsection*{S3. Derivation of $\widetilde{\gamma^{T}\Sigma\gamma}$}

Start from
\[
\gamma_{0\to t}^T \Sigma^{\text{prior}}_{0\to t} \gamma_{0\to t}
= \sum_{i_0,i_t}\sum_{j_0,j_t}
\overline{\Gamma}_{i_0\to i_t}\,
\Sigma^{\text{prior}}_{0\to t,(i_0\to i_t)(j_0\to j_t)}\,
\overline{\Gamma}_{j_0\to j_t}.
\]

Substitute the covariance and split into:
\[
T_1 = \overline{\gamma}_0^T(\Sigma^{\text{prior}}_0 - \mathrm{diag}(\mu^{\text{prior}}_0))\overline{\gamma}_0,
\]
\[
T_2 = \sum_{i_0}\mu^{\text{prior}}_{0,i_0}\sum_{i_t}
(\overline{\Gamma}_{i_0\to i_t}P_{i_0\to i_t}(t))^2.
\]

Thus,
\[
\widetilde{\gamma^{T}\Sigma\gamma}
= T_1 + T_2.
\]

\subsection*{S4. Derivation of the Vector $\widetilde{\gamma^{T}\Sigma}$}

Define
\[
(\widetilde{\gamma^{T}\Sigma})_{i_t}
=
\sum_{i_0,j_0,j_t}
\overline{\Gamma}_{j_0\to j_t}\,
\Sigma^{\text{prior}}_{0\to t,(j_0\to j_t)(i_0\to i_t)}.
\]

Inserting the boundary covariance yields:
\[
(\widetilde{\gamma^{T}\Sigma})_{i_t}
=
\overline{\gamma}_0^T
(\Sigma^{\text{prior}}_0 - \mathrm{diag}(\mu^{\text{prior}}_0))P(:,i_t)
+
\sum_{i_0}\mu^{\text{prior}}_{0,i_0}P_{i_0\to i_t}(t)\overline{\Gamma}_{i_0\to i_t}.
\]

\subsection*{S5. Final Covariance Update}

The propagated covariance is
\[
\Sigma^{\text{prop}}(t)
=
P(t)^T(\Sigma^{\text{prior}}_0 - \mathrm{diag}(\mu^{\text{prior}}_0))P(t)
+ \mathrm{diag}(\mu^{\text{prior}}(t)),
\qquad
\mu^{\text{prior}}(t)=\mu^{\text{prior}}_0P(t).
\]

The posterior covariance (scalar Gaussian update) is
\[
\Sigma^{\text{prior}}(t)
=
\Sigma^{\text{prop}}(t)
-
\frac{1}{\sigma^2_{\overline{y}^{\mathrm{pred}}_{0\to t}}}
\widetilde{\gamma^{T}\Sigma}^T
\widetilde{\gamma^{T}\Sigma}.
\]

\end{document}
